<!doctype html><html lang=zh-cn class=theme-container><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><title>Android发布库到MavenCentral</title><link rel=canonical href=https://www.jiangyy.com/><link rel=stylesheet type=text/css href=/css/common.min.a773b000f0a3d73278522b94fc023fc3905bf5780aad2e9abe6dcdb93fb0931c.css><link rel=stylesheet media='screen and (min-width: 1201px)' type=text/css href=/css/normal.min.ef47e06b8387d30f9d517f7914ed9d33b5a8548d76413b6642068e836a961ca1.css><link rel=stylesheet media='screen and (max-width: 1200px)' type=text/css href=/css/small.min.78335e5b7dae8c87809aae529082ab972e438755e7810bd231472e266e0d9c35.css><link rel=stylesheet type=text/css href=/css/androidstudio.min.min.c0869a17349d3f1bdd078763e8c11ec9808c9f38239bb254720577662fba87bf.css><script src=/js/highlight.min.min.527b2c4dd19de47518d2a0fbbf849f2cf1230a7e6e40ee0f416f4de8f8539fbf.js></script></head><script>hljs.highlightAll()</script><body><div class=top><a href=/><img src=logo.png></a><nav><a href=/wiki/>教程</a>
<a href=/blog/>博客</a>
<a href=/share/>分享</a>
<a href=/projects/>项目</a></nav></div><div id=center class=center><header class=center_head><h1>Android发布库到MavenCentral</h1><div style=text-align:center;opacity:.5;margin-top:.5em>2022.08.23 09:43</div></header><div class=center_main><a href=../ class=center_main_contents_left><h1>博客</h1></a><style>.content_post h2::before{content:"※ "}.content_post h3::before{content:"✧ "}</style><article class="content_post heti heti--ancient"><p>jCenter不再接受任何新库的提交，Google也已经给出了其官方态度，建议开发者以后发布库都发布到MavenCentral上。</p><div class=highlight><span class=highlight-type>gradle</span><pre><code class="language-gradle hljs" data-lang=gradle>pluginManagement {
    repositories {
        gradlePluginPortal()
        google()
        mavenCentral()
    }
}</code></pre></div><style>.highlight-type{content:"gradle";position:absolute;opacity:.5}</style><blockquote><p>相对于jCenter，MavenCentral的使用显得不那么简单，发布标准、域名限制也是要限制不少。</p></blockquote><h2 id=域名准备>域名准备</h2><p>加入你要提交一个开源库，引用路径如下：</p><div class=highlight><span class=highlight-type>gradle</span><pre><code class="language-gradle hljs" data-lang=gradle>implementation &#39;com.example:core:1.0.0&#39;</code></pre></div><style>.highlight-type{content:"gradle";position:absolute;opacity:.5}</style><p>那么，你必须要拥有<code>example.com</code>这个域名，而这在jCenter那并不做限制。如果你没有域名，也不想花钱，也不是没有办法，我们可以使用Github/Gitee,那么我们引入的路径就成为了：</p><div class=highlight><span class=highlight-type>gradle</span><pre><code class="language-gradle hljs" data-lang=gradle>implementation &#39;io.github.yourusername:core:1.0.0&#39;

implementation &#39;io.gitee.yourusername:core:1.0.0&#39;</code></pre></div><style>.highlight-type{content:"gradle";position:absolute;opacity:.5}</style><h2 id=创建issue>创建Issue</h2><blockquote><p>Sonatype Issue网址：<a href=https://issues.sonatype.org/>https://issues.sonatype.org/</a></p></blockquote><h3 id=进入sonatype-issue网站创建账号并登录>进入Sonatype Issue网站，创建账号并登录。</h3><table><thead><tr><th style=text-align:center></th><th></th></tr></thead><tbody><tr><td style=text-align:center>Email</td><td>邮箱，每次操作，都会收到通知</td></tr><tr><td style=text-align:center>Full name</td><td>联系人名称</td></tr><tr><td style=text-align:center>Username</td><td>用户名，也是登录账号，上传代码时会用到</td></tr><tr><td style=text-align:center>Password</td><td>密码，至少8位，带有大小写字母和字符，上传代码时会用到</td></tr></tbody></table><h3 id=点击新建创建issue>点击新建，创建Issue</h3><table><thead><tr><th style=text-align:center></th><th></th></tr></thead><tbody><tr><td style=text-align:center>项目</td><td>Community Support - Open Source Project Repository Hosting (OSSRH)</td></tr><tr><td style=text-align:center>问题类型</td><td>New Project</td></tr><tr><td style=text-align:center>概要</td><td>可以随便填，或者直接填New Project</td></tr><tr><td style=text-align:center>Group Id</td><td>你的开源库引用路径的Group Id；如果是github项目，就填写io.github.myusername；如果是gitee项目，就填写io.gitee.myusername</td></tr><tr><td style=text-align:center>Project URL</td><td>例如https://github.com/sonatype/nexus-public</td></tr><tr><td style=text-align:center>SCM url</td><td>例如https://github.com/sonatype/nexus-public.git</td></tr></tbody></table><h2 id=配置域名>配置域名</h2><p>Issue创建成功后，会生成一个类似<code>OSSRH-XXXXX</code>的ID，记下这个ID。</p><p>如果上一步的Group Id，你选择了github/gitee，那么你只需要在github中创建一个名为<code>OSSRH-XXXXX</code>的项目，权限设置为public。</p><p>如果您使用了自定义域名的Group Id，那么你需要在域名解析中添加一条记录。</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center></th><th style=text-align:center></th></tr></thead><tbody><tr><td style=text-align:center>主机记录</td><td style=text-align:center>记录类型</td><td style=text-align:center>记录值</td></tr><tr><td style=text-align:center>@</td><td style=text-align:center>TXT</td><td style=text-align:center>OSSRH-XXXXX</td></tr></tbody></table><p>域名配置成功后，我们进入创建的问题，添加一条评论<code>Done</code>以告诉审核人员就可以了。</p><p>接下来就是耐心的等待，一般不会太长，5-10分钟就可以了。审核通过后，我们的Maven仓库就可以使用了。</p><h2 id=配置签名>配置签名</h2><blockquote><p>官方文档：<a href=https://central.sonatype.org/publish/requirements/gpg/>https://central.sonatype.org/publish/requirements/gpg/</a></p></blockquote><h3 id=下载gpg>下载GPG</h3><p>在MavenCentral上传的代码都需要GPG签名。下载地址：<a href=http://www.gnupg.org/download/>http://www.gnupg.org/download/</a></p><p>安装完成后，<code>gpg --version</code>查看版本。</p><h3 id=创建gpg密钥>创建GPG密钥</h3><p>密钥的创建我们可以采用kleopatra生成，也可以使用命令行生成。我这里记录一下命令行生成过程：</p><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>$ gpg --gen-key</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><p>输入名称和邮箱地址</p><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>Real name: Central Repo Test
Email address: central@example.com</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><p>输入<code>O</code>以确认</p><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>Change (N)ame, (E)mail, or (O)kay/(Q)uit? O</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><p>输入8位以上的密码，点击OK即可</p><figure><img src=https://s1.ax1x.com/2022/08/24/vc5ZDS.png></figure><p>查询所有本地生成的key列表</p><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>$ gpg --list-keys
C:\Users\Administer\AppData\Roaming\gnupg\pubring.kbx
---------------------------------------------------------
pub   ed25519 2022-08-24 [SC] [expires: 2024-08-23]
      EE230A4B217369C1713B5FF44F6579788EB730F1
uid           [ultimate] Central Repo Test &lt;central@example.com&gt;
sub   cv25519 2022-08-24 [E] [expires: 2024-08-23]</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><h3 id=上传密钥至gpg服务器>上传密钥至GPG服务器</h3><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>gpg --keyserver keyserver.ubuntu.com --send-keys EE230A4B217369C1713B5FF44F6579788EB730F1</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><p>--keyserver指定密钥服务器地址，可选：</p><ul><li>keyserver.ubuntu.com</li><li>keys.openpgp.org</li><li>pgp.mit.edu</li></ul><p>--send-keys指定密钥的keyid</p><h3 id=导出私钥>导出私钥</h3><div class=highlight><span class=highlight-type>powershell</span><pre><code class="language-powershell hljs" data-lang=powershell>gpg -o D:\secring.gpg --export-secret-keys EE230A4B217369C1713B5FF44F6579788EB730F1</code></pre></div><style>.highlight-type{content:"powershell";position:absolute;opacity:.5}</style><h2 id=上传代码>上传代码</h2><p>build.gradle</p><div class=highlight><span class=highlight-type>groovy</span><pre><code class="language-groovy hljs" data-lang=groovy>plugins {
    id &#39;com.android.library&#39;
    id &#39;org.jetbrains.kotlin.android&#39;
    id &#39;maven-publish&#39;
    id &#39;signing&#39;
}

group = &#39;GROUP ID&#39;
version = &#39;1.0.0&#39;

publishing {
    publications {
        maven(MavenPublication) {
            afterEvaluate {
                artifact(tasks.getByName(&#34;bundleReleaseAar&#34;))
            }
            artifactId = &#39;ARTIFACT ID&#39;
            pom {
                name = &#39;MODULE NAME&#39;
                description = &#39;MODULE DESC&#39;
                url = &#39;https://github.com/example/example&#39;
                licenses {
                    license {
                        name = &#39;The Apache License, Version 2.0&#39;
                        url = &#39;http://www.apache.org/licenses/LICENSE-2.0.txt&#39;
                    }
                }
                developers {
                    developer {
                        id = &#39;YOUR ID&#39;
                        name = &#39;YOUR NAME&#39;
                        email = &#39;YOUR EMAIL&#39;
                    }
                }
                scm {
                    connection = &#39;scm:git:git://github.com/example/example.git&#39;
                    developerConnection = &#39;scm:git:ssh://github.com/example/example.git&#39;
                    url = &#39;https://github.com/example/example&#39;
                }
            }
        }
    }
    repositories {
        maven {
            def releasesRepoUrl = &#39;https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/&#39;
            def snapshotsRepoUrl = &#39;https://s01.oss.sonatype.org/content/repositories/snapshots/&#39;
            url = version.endsWith(&#39;SNAPSHOT&#39;) ? snapshotsRepoUrl : releasesRepoUrl
            credentials {
                username = ossrhUsername
                password = ossrhPassword
            }
        }
    }
}

signing {
    sign publishing.publications.maven
}</code></pre></div><style>.highlight-type{content:"groovy";position:absolute;opacity:.5}</style><p>gradle.properties</p><div class=highlight><span class=highlight-type>properties</span><pre><code class="language-properties hljs" data-lang=properties>signing.keyId=密钥ID
signing.password=密钥密码
signing.secretKeyRingFile=D:\secring.gpg
ossrhUsername=sonatype的用户名
ossrhPassword=sonatype的密码</code></pre></div><style>.highlight-type{content:"properties";position:absolute;opacity:.5}</style><h2 id=发布>发布</h2><p>进入<a href=https://s01.oss.sonatype.org/>https://s01.oss.sonatype.org/</a>，账号和密码就是Issue系统的账号密码。</p><p>点击左侧的<code>Staging Repositories</code>，我们就可以看到我们上传的代码包了。</p><p>上方菜单栏共包括五个按钮：Refresh/Close/Promote/Release/Drop。</p><p>选中我们上传的代码包，点击<code>Close</code>，开始验证代码。</p><p>验证完成后，点击<code>Refrsh</code>，再点击<code>Release</code>即可发布。</p><p>发布完成后，我们可以立即在<a href=https://s01.oss.sonatype.org/content/repositories/releases/>Sonatype的内容代码库</a>看到我们发布的代码库，但是还不能使用依赖引入下载。一般还需要十分钟左右，您的代码版本就会出现在<a href=https://repo1.maven.org/maven2/>公开的Maven仓库列表</a>，而这时你就可以随意使用了。</p></article><div class=content_post_button><button onclick='window.location.href="https://www.jiangyy.com/blog/android-studio-plugin/"'>
<span style=color:var(--primary-color)>上一篇</span><br>从零开始开发一款JetBrains系插件</button>
<button onclick='window.location.href="https://www.jiangyy.com/blog/git/"'>
<span style=color:var(--primary-color)>下一篇</span><br>Git的使用指北</button></div><a class=back_top href=javascript:window.scrollTo(0,0);><svg t="1660722824713" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1359" width="64" height="64"><path d="M484 93.668c-231.038.0-418.333 187.296-418.333 418.335C65.667 743.041 252.963 930.33 484 930.33c231.036.0 418.333-187.289 418.333-418.327C902.334 280.964 715.036 93.668 484 93.668zM372.207 811.881c-.412 8.174-4.906 12.669-13.493 13.493-6.545.0-11.863-.614-15.946-1.841-4.504-1.639-6.545-4.906-6.133-9.813 1.629-4.906 4.695-7.148 9.199-6.746 6.948 1.639 10.215.613 9.813-3.066v-96.902h-12.266c-4.504-.402-6.746-3.268-6.746-8.586.402-4.907 2.855-7.562 7.359-7.974h36.185c2.453.0 4.083 1.025 4.906 3.066 1.227-2.855 3.469-4.494 6.747-4.906h82.183c4.495.412 6.747 3.277 6.747 8.587-.412 5.318-2.865 8.184-7.36 8.586h-36.798l-2.453 11.652h23.919c10.215-.402 14.92 3.891 14.106 12.88v63.17c-.412 4.504-3.277 6.957-8.586 7.36-5.318-.403-8.184-2.856-8.586-7.36v-57.037c0-1.227-.613-1.84-1.84-1.84h-43.545c-.824.412-1.438 1.025-1.84 1.84v55.811c-.412 4.906-3.277 7.57-8.586 7.974-5.318-.403-8.184-3.067-8.586-7.974v-61.943c0-8.586 3.68-12.88 11.04-12.88h14.719l3.066-11.652h-25.759c-2.453.0-5.117-1.016-7.973-3.066-1.227 2.865-3.479 4.293-6.746 4.293h-6.747L372.207 811.881zm107.329 12.265c-3.277 4.907-7.571 5.722-12.879 2.454-2.865-1.227-7.571-3.891-14.106-7.974-6.133-3.277-10.838-5.52-14.106-6.746-6.133-2.855-8.586-6.334-7.359-10.426-1.227 2.051-3.68 4.504-7.36 7.359-.412.412-.824.824-1.227 1.227-9.41 7.762-20.239 13.896-32.505 18.399-5.73 1.629-9.813.201-12.266-4.294-1.639-4.906.0-8.586 4.906-11.039 18.802-7.762 30.253-15.534 34.345-23.306 4.494-7.359 6.746-21.054 6.746-41.091.403-5.722 3.067-8.788 7.973-9.2 5.309.412 8.174 3.479 8.586 9.2.814 20.852-1.639 36.798-7.36 47.837 4.083-4.906 9.401-5.107 15.946-.613 4.907 2.865 11.442 6.546 19.626 11.04 3.68 2.453 6.334 4.092 7.973 4.906C481.375 814.736 482.391 818.828 479.536 824.146zM556.198 822.307h-41.704c-7.772-.412-11.864-3.891-12.267-10.426v-34.345c-.412-8.989 3.68-13.282 12.267-12.88h42.931c7.763-.402 11.653 3.891 11.653 12.88v34.958C569.48 819.029 565.188 822.307 556.198 822.307zM614.462 817.4c-6.545.0-11.652-.824-15.332-2.453-4.092-2.051-5.318-5.309-3.68-9.813 1.629-4.906 5.107-6.747 10.426-5.52 11.04 2.453 15.735-1.841 14.106-12.88-.412-8.174-5.933-18.399-16.56-30.665-3.68-3.68-4.293-9.2-1.84-16.56 4.494-13.895 7.561-24.532 9.199-31.892h-16.559c-1.227.0-2.051.824-2.453 2.453v110.395c-.412 5.31-3.067 8.175-7.974 8.587-5.318-.412-8.184-3.277-8.586-8.587v-65.01c-1.227 1.639-2.865 2.453-4.906 2.453h-69.304c-4.504-.402-6.957-3.268-7.359-8.586.402-5.31 2.855-8.175 7.359-8.587h14.72c-.824-.814-3.68-5.721-8.586-14.719-2.051-5.31-.613-8.989 4.293-11.04h-7.36c-4.504-.402-6.957-3.268-7.359-8.586.402-5.309 2.855-8.174 7.359-8.586h22.079c-.824-1.227-1.227-2.453-1.227-3.681-1.227-4.082.613-7.359 5.52-9.813 5.721-2.041 9.401-1.016 11.04 3.066 1.227 3.68 2.654 7.158 4.293 10.427h20.239c4.494.412 6.947 3.277 7.359 8.586-.412 5.318-2.865 8.184-7.359 8.586h-47.225c2.855 1.639 6.334 7.36 10.426 17.173 1.227 4.092.814 6.957-1.227 8.586h13.493c.402-1.227 1.016-2.855 1.84-4.906 2.453-6.133 4.082-11.039 4.906-14.72 1.629-4.082 5.107-5.721 10.426-4.906 4.906 2.051 6.747 5.318 5.521 9.813-.824 2.051-1.639 4.504-2.454 7.359-1.227 3.277-2.252 5.932-3.066 7.973h11.04c2.453.0 4.082.613 4.906 1.84v-41.704c0-8.175 3.066-12.056 9.199-11.653h36.799c9.4.0 13.08 5.117 11.039 15.333.0.412-1.025 3.891-3.066 10.426-3.277 10.226-5.52 17.786-6.746 22.692-1.227 3.68-1.84 6.344-1.84 7.973.402 1.228 1.629 3.067 3.68 5.521 8.586 13.09 13.281 25.356 14.105 36.798C638.17 807.387 630.408 816.988 614.462 817.4zm32.434-351.085c-7.488 7.449-18.815 7.642-25.649.806-.538-.537-1.074-.922-1.536-1.535L502.752 348.858l-.192 280.106c0 9.139-8.601 16.549-19.198 16.549-10.598.0-18.738-7.41-18.738-16.549.0-.729-.115-1.306.0-2.034l-.192-278.072L347.513 465.586c-.422.652-.959.999-1.536 1.535-6.834 6.874-18.162 6.681-25.649-.806-7.488-7.488-8.025-19.122-1.152-25.995L467.12 292.03c2.112-3.263 5.26-5.913 9.369-7.333 2.074-.807 4.262-1.152 6.528-1.113.23.0.383-.116.614-.116.153.0.307.078.46.078 2.304-.078 4.57.307 6.72 1.152 3.994 1.421 7.142 4.07 9.254 7.219L648.048 440.32C654.92 447.155 654.383 458.827 646.896 466.315zM636.605 238.121H331.771c-9.407.0-17.049-7.564-17.049-16.857.0-9.292 7.642-16.856 17.049-16.856h304.835c9.445.0 17.048 7.564 17.048 16.856C653.653 230.557 646.013 238.121 636.605 238.121zM549.452 781.829H521.24c-1.227.0-2.051.824-2.453 2.453v19.013c.402 1.639 1.227 2.453 2.453 2.453h28.212c1.629-.402 2.453-1.227 2.453-2.453v-19.013C551.905 782.653 551.081 781.829 549.452 781.829z" p-id="1360" fill="#343232"/></svg></a><div class=center_main_contents_title><h2>目录</h2></div><div class=center_main_contents_main><nav id=TableOfContents><ul><li><a href=#域名准备>域名准备</a></li><li><a href=#创建issue>创建Issue</a><ul><li><a href=#进入sonatype-issue网站创建账号并登录>进入Sonatype Issue网站，创建账号并登录。</a></li><li><a href=#点击新建创建issue>点击新建，创建Issue</a></li></ul></li><li><a href=#配置域名>配置域名</a></li><li><a href=#配置签名>配置签名</a><ul><li><a href=#下载gpg>下载GPG</a></li><li><a href=#创建gpg密钥>创建GPG密钥</a></li><li><a href=#上传密钥至gpg服务器>上传密钥至GPG服务器</a></li><li><a href=#导出私钥>导出私钥</a></li></ul></li><li><a href=#上传代码>上传代码</a></li><li><a href=#发布>发布</a></li></ul></nav></div></div></div></body></html>